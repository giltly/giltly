(function(){d3.timeline=function(){var v=["circle","rect"],s=function(){},t=function(){},u=function(){},r=function(){},q=function(){},p="bottom",d=null,f=null,i={format:d3.time.format("%I %p"),tickTime:d3.time.hours,tickNumber:1,tickSize:6},j=d3.scale.category20(),l=null,o="rect",e=0,g=0,b={left:30,right:30,top:30,bottom:30},k=false,n=false,c=20,h=5,m=false;showTodayFormat={marginTop:25,marginBottom:0,width:1,color:j};function a(a){var v=a.append("g"),y=a[0][0].getBoundingClientRect(),x=d3.select(a[0][0]),w={},C=1,z=0,D=0;J();if(k||g==0&&e==0){v.each(function(a){a.forEach(function(b,a){if(k&&Object.keys(w).indexOf(a)==-1){w[a]=C;C++}g==0&&e==0&&b.times.forEach(function(a){if(a.starting_time<z||z==0)z=a.starting_time;if(a.ending_time>D)D=a.ending_time})})});if(g==0&&e==0){e=z;g=D}}var B=1/(g-e)*(d-b.left-b.right),A=d3.time.scale().domain([e,g]).range([b.left,d-b.right]),K=d3.svg.axis().scale(A).orient(p).tickFormat(i.format).ticks(i.tickTime,i.tickNumber).tickSize(i.tickSize);v.append("g").attr("class","axis").attr("transform","translate("+0+","+(b.top+(c+h)*C)+")").call(K);v.each(function(d){d.forEach(function(d,e){var i=d.times,g=typeof d.label!="undefined";v.selectAll("svg").data(i).enter().append(o).attr("x",F).attr("y",f).attr("width",function(a){return(a.ending_time-a.starting_time)*B}).attr("cy",f).attr("cx",F).attr("r",c/2).attr("height",c).style("fill",function(){return l?j(d[l]):j(e)}).on("mousemove",function(a){s(a,e,d)}).on("mouseover",function(a,b){t(a,b,d)}).on("mouseout",function(a,b){u(a,b,d)}).on("click",function(a){r(a,e,d)});g&&a.append("text").attr("class","timeline-label").attr("transform","translate("+0+","+(c/2+b.top+(c+h)*w[e])+")").text(g?d.label:d.id);typeof d.icon!="undefined"&&a.append("image").attr("class","timeline-label").attr("transform","translate("+0+","+(b.top+(c+h)*w[e])+")").attr("xlink:href",d.icon).attr("width",b.left).attr("height",c);function f(){return k?b.top+(c+h)*w[e]:b.top}})});if(d>y.width){function L(){var a=Math.min(0,Math.max(y.width-d,d3.event.translate[0]));H.translate([a,0]);v.attr("transform","translate("+a+",0)");q(a*B,A)}var H=d3.behavior.zoom().x(A).on("zoom",L);a.attr("class","scrollable").call(H)}n&&v.selectAll("text").attr("transform",function(){return"rotate("+n+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var G=v[0][0].getBoundingClientRect();I();if(m){var E=A(new Date);a.append("svg:line").attr("x1",E).attr("y1",showTodayFormat.marginTop).attr("x2",E).attr("y2",f-showTodayFormat.marginBottom).style("stroke",showTodayFormat.color).style("stroke-width",showTodayFormat.width)}function F(a){return b.left+(a.starting_time-e)*B}function I(){if(!f&&!x.attr("height"))if(c){f=G.height+G.top-y.top;d3.select(a[0][0]).attr("height",f)}else throw"height of the timeline is not set";else if(!f)f=x.attr("height");else x.attr("height",f)}function J(){if(!d&&!y.width)throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render";else if(!(d&&y.width))if(!d)d=x.attr("width");else x.attr("width",d)}}a.margin=function(c){if(!arguments.length)return b;b=c;return a};a.orient=function(b){if(!arguments.length)return p;p=b;return a};a.itemHeight=function(b){if(!arguments.length)return c;c=b;return a};a.itemMargin=function(b){if(!arguments.length)return h;h=b;return a};a.height=function(b){if(!arguments.length)return f;f=b;return a};a.width=function(b){if(!arguments.length)return d;d=b;return a};a.display=function(b){if(!arguments.length||v.indexOf(b)==-1)return o;o=b;return a};a.tickFormat=function(b){if(!arguments.length)return i;i=b;return a};a.hover=function(b){if(!arguments.length)return s;s=b;return a};a.mouseover=function(b){if(!arguments.length)return b;t=b;return a};a.mouseout=function(b){if(!arguments.length)return b;u=b;return a};a.click=function(b){if(!arguments.length)return r;r=b;return a};a.scroll=function(b){if(!arguments.length)return q;q=b;return a};a.colors=function(b){if(!arguments.length)return j;j=b;return a};a.beginning=function(b){if(!arguments.length)return e;e=b;return a};a.ending=function(b){if(!arguments.length)return g;g=b;return a};a.rotateTicks=function(b){n=b;return a};a.stack=function(){k=!k;return a};a.showToday=function(){m=!m;return a};a.showTodayFormat=function(b){if(!arguments.length)return showTodayFormat;showTodayFormat=b;return a};a.colorProperty=function(b){if(!arguments.length)return l;l=b;return a};return a}})();