(function(a){if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object")a(require("knockout"),exports);else if(typeof define==="function"&&define.amd)define(["knockout","exports"],a);else a(ko,ko.validation={})})(function(b,m){if(typeof b===undefined)throw"Knockout is required, please ensure it is loaded before loading this validation plug-in";b.validation=m;var a=b.validation,f=b.utils,d=f.unwrapObservable,e=f.arrayForEach,c=f.extend,i={registerExtenders:true,messagesOnModified:true,errorsAsTitle:true,errorsAsTitleOnModified:false,messageTemplate:null,insertMessages:true,parseInputAttributes:false,writeInputAttributes:false,decorateInputElement:false,decorateElementOnModified:true,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",allowHtmlMessages:false,grouping:{deep:false,observable:true},validate:{}},g=c({},i);g.html5Attributes=["required","pattern","min","max","step"];g.html5InputTypes=["email","number","date"];g.reset=function(){c(g,i)};a.configuration=g;a.utils=function(){var d=(new Date).getTime(),c={},b="__ko_validation__";return{isArray:function(a){return a.isArray||Object.prototype.toString.call(a)==="[object Array]"},isObject:function(a){return a!==null&&typeof a==="object"},values:function(a){var c=[];for(var b in a)a.hasOwnProperty(b)&&c.push(a[b]);return c},getValue:function(a){return typeof a==="function"?a():a},hasAttribute:function(b,a){return b.getAttribute(a)!==null},getAttribute:function(a,b){return a.getAttribute(b)},setAttribute:function(a,c,b){return a.setAttribute(c,b)},isValidatable:function(a){return!!(a&&a.rules&&a.isValid&&a.isModified)},insertAfter:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},newId:function(){return d+=1},getConfigOptions:function(b){var c=a.utils.contextFor(b);return c||a.configuration},setDomData:function(e,f){var d=e[b];if(!d)e[b]=d=a.utils.newId();c[d]=f},getDomData:function(d){var a=d[b];return!a?undefined:c[a]},contextFor:function(b){switch(b.nodeType){case 1:case 8:var c=a.utils.getDomData(b);if(c)return c;if(b.parentNode)return a.utils.contextFor(b.parentNode)}return undefined},isEmptyVal:function(a){return a===undefined?true:a===null?true:a===""?true:void 0},getOriginalElementTitle:function(b){var d=a.utils.getAttribute(b,"data-orig-title"),e=b.title,c=a.utils.hasAttribute(b,"data-orig-title");return c?d:e},async:function(a){if(window.setImmediate)window.setImmediate(a);else window.setTimeout(a,0)},forEach:function(b,d){if(a.utils.isArray(b))return e(b,d);for(var c in b)b.hasOwnProperty(c)&&d(b[c],c)}}}();var n=function(){var k=0,h=a.configuration,g=a.utils;function i(c,a,e){var h=[],f=d(c);if(!a.flagged)a.flagged=[];if(!a.toValidate)a.toValidate=[];if(c.__kv_traversed===true)return;if(a.deep){c.__kv_traversed=true;a.flagged.push(c)}e=e!==undefined?e:a.deep?1:-1;if(b.isObservable(c)){!c.isValid&&c.extend({validatable:true});a.toValidate.push(c)}if(f&&(g.isArray(f)||g.isObject(f)))h=f;e!==0&&g.forEach(h,function(b){b&&!b.nodeType&&i(b,a,e+1)})}function j(b){var a=[];e(b,function(b){!b.isValid()&&a.push(b.error)});return a}return{init:function(b,d){if(k>0&&!d)return;b=b||{};b.errorElementClass=b.errorElementClass||b.errorClass||h.errorElementClass;b.errorMessageClass=b.errorMessageClass||b.errorClass||h.errorMessageClass;c(h,b);h.registerExtenders&&a.registerExtenders();k=1},configure:function(b){a.init(b)},reset:a.configuration.reset,group:function(k,a){a=c(c({},h.grouping),a);var g=b.observableArray([]),d=null,l=function(){if(a.deep){e(a.flagged,function(a){delete a.__kv_traversed});a.flagged.length=0}a.toValidate=[]};if(a.observable){i(k,a);g(a.toValidate);l();d=b.computed(function(){return j(g())})}else d=function(){i(k,a);g(a.toValidate);l();return j(g())};d.showAllMessages=function(a){if(a===undefined)a=true;d();e(g(),function(b){b.isModified(a)})};k.errors=d;k.isValid=function(){return k.errors().length===0};k.isAnyMessageShown=function(){var a=false;d();a=!!f.arrayFirst(g(),function(a){return!a.isValid()&&a.isModified()});return a};return d},formatMessage:function(a,b){return typeof a==="function"?a(b):a.replace(/\{0\}/gi,d(b))},addRule:function(a,b){a.extend({validatable:true});a.rules.push(b);return a},addAnonymousRule:function(c,b){if(b.message===undefined)b.message="Error";if(b.onlyIf)b.condition=b.onlyIf;a.addRule(c,b)},addExtender:function(c){b.extenders[c]=function(d,b){return b&&(b.message||b.onlyIf)?a.addRule(d,{rule:c,message:b.message,params:g.isEmptyVal(b.params)?true:b.params,condition:b.onlyIf}):a.addRule(d,{rule:c,params:b})}},registerExtenders:function(){if(h.registerExtenders)for(var c in a.rules)if(a.rules.hasOwnProperty(c))!b.extenders[c]&&a.addExtender(c)},insertValidationMessage:function(b){var a=document.createElement("SPAN");a.className=g.getConfigOptions(b).errorMessageClass;g.insertAfter(b,a);return a},parseInputValidationAttributes:function(b,c){e(a.configuration.html5Attributes,function(d){if(g.hasAttribute(b,d)){var f=b.getAttribute(d)||true;if(d==="min"||d==="max"){var e=b.getAttribute("type");if(typeof e==="undefined"||!e)e="text";f={typeAttr:e,value:f}}a.addRule(c(),{rule:d,params:f})}});var d=b.getAttribute("type");e(a.configuration.html5InputTypes,function(b){b===d&&a.addRule(c(),{rule:b==="date"?"dateISO":b,params:true})})},writeInputValidationAttributes:function(g,d){var b=d();if(!b||!b.rules)return;var c=b.rules();e(a.configuration.html5Attributes,function(d){var b,a=f.arrayFirst(c,function(a){return a.rule.toLowerCase()===d.toLowerCase()});if(!a)return;b=a.params;if(a.rule==="pattern")if(a.params instanceof RegExp)b=a.params.source;g.setAttribute(d,b)});c=null},makeBindingHandlerValidatable:function(a){var c=b.bindingHandlers[a].init;b.bindingHandlers[a].init=function(g,e,a,f,d){c(g,e,a,f,d);return b.bindingHandlers.validationCore.init(g,e,a,f,d)}},setRules:function(f,e){var c=function(m,i){if(!m||!i)return;for(var j in i){if(!i.hasOwnProperty(j))continue;var h=i[j];if(!m[j])continue;var k=m[j],f=d(k),o={},l={};for(var e in h){if(!h.hasOwnProperty(e))continue;if(a.rules[e])o[e]=h[e];else l[e]=h[e]}b.isObservable(k)&&k.extend(o);if(f&&g.isArray(f))for(var n=0;n<f.length;n++)c(f[n],l);else c(f,l)}};c(f,e)}}}();c(b.validation,n);a.rules={};a.rules.required={validator:function(a,c){var d=/^\s+|\s+$/g,b;if(a===undefined||a===null)return!c;b=a;if(typeof a==="string")b=a.replace(d,"");return!c?true:(b+"").length>0},message:"This field is required."};function h(c){var b=c==="max";return function(g,i){if(a.utils.isEmptyVal(g))return true;var f,j;if(i.typeAttr===undefined){j="text";f=i}else{j=i.typeAttr;f=i.value}if(!isNaN(f))j="number";var h,e,d;switch(j.toLowerCase()){case"week":h=/^(\d{4})-W(\d{2})$/;e=g.match(h);if(e===null)throw"Invalid value for "+c+" attribute for week input.  Should look like '2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min";d=f.match(h);if(!d)return false;if(b)return e[1]<d[1]||e[1]===d[1]&&e[2]<=d[2];else return e[1]>d[1]||e[1]===d[1]&&e[2]>=d[2];break;case"month":h=/^(\d{4})-(\d{2})$/;e=g.match(h);if(e===null)throw"Invalid value for "+c+" attribute for month input.  Should look like '2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min";d=f.match(h);if(!d)return false;if(b)return e[1]<d[1]||e[1]===d[1]&&e[2]<=d[2];else return e[1]>d[1]||e[1]===d[1]&&e[2]>=d[2];break;case"number":case"range":if(b)return!isNaN(g)&&parseFloat(g)<=parseFloat(f);else return!isNaN(g)&&parseFloat(g)>=parseFloat(f);break;default:return b?g<=f:g>=f}}}a.rules.min={validator:h("min"),message:"Please enter a value greater than or equal to {0}."};a.rules.max={validator:h("max"),message:"Please enter a value less than or equal to {0}."};a.rules.minLength={validator:function(b,c){return a.utils.isEmptyVal(b)||b.length>=c},message:"Please enter at least {0} characters."};a.rules.maxLength={validator:function(b,c){return a.utils.isEmptyVal(b)||b.length<=c},message:"Please enter no more than {0} characters."};a.rules.pattern={validator:function(b,c){return a.utils.isEmptyVal(b)||b.toString().match(c)!==null},message:"Please check this value."};a.rules.step={validator:function(d,b){if(a.utils.isEmptyVal(d)||b==="any")return true;var c=d*100%(b*100);return Math.abs(c)<1e-5||Math.abs(1-c)<1e-5},message:"The value must increment by {0}"};a.rules.email={validator:function(c,b){return!b?true:a.utils.isEmptyVal(c)||b&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(c)},message:"Please enter a proper email address"};a.rules.date={validator:function(c,b){return!b?true:a.utils.isEmptyVal(c)||b&&!/Invalid|NaN/.test(new Date(c))},message:"Please enter a proper date"};a.rules.dateISO={validator:function(c,b){return!b?true:a.utils.isEmptyVal(c)||b&&/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(c)},message:"Please enter a proper date"};a.rules.number={validator:function(c,b){return!b?true:a.utils.isEmptyVal(c)||b&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(c)},message:"Please enter a number"};a.rules.digit={validator:function(c,b){return!b?true:a.utils.isEmptyVal(c)||b&&/^\d+$/.test(c)},message:"Please enter a digit"};a.rules.phoneUS={validator:function(b,c){if(!c)return true;if(a.utils.isEmptyVal(b))return true;if(typeof b!=="string")return false;b=b.replace(/\s+/g,"");return c&&b.length>9&&b.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},message:"Please specify a valid phone number"};a.rules.equal={validator:function(d,c){var b=c;return d===a.utils.getValue(b)},message:"Values must equal"};a.rules.notEqual={validator:function(d,c){var b=c;return d!==a.utils.getValue(b)},message:"Please choose another value."};a.rules.unique={validator:function(d,b){var e=a.utils.getValue(b.collection),g=a.utils.getValue(b.externalValue),c=0;if(!d||!e)return true;f.arrayFilter(e,function(a){if(d===(b.valueAccessor?b.valueAccessor(a):a))c++});return c<(!!g?1:2)},message:"Please make sure the value is unique."};(function(){a.registerExtenders()})();b.bindingHandlers.validationCore=function(){return{init:function(e,f){var d=a.utils.getConfigOptions(e),c=f();d.parseInputAttributes&&a.utils.async(function(){a.parseInputValidationAttributes(e,f)});if(d.insertMessages&&a.utils.isValidatable(c)){var g=a.insertValidationMessage(e);if(d.messageTemplate)b.renderTemplate(d.messageTemplate,{field:c},null,g,"replaceNode");else b.applyBindingsToNode(g,{validationMessage:c})}d.writeInputAttributes&&a.utils.isValidatable(c)&&a.writeInputValidationAttributes(e,f);d.decorateInputElement&&a.utils.isValidatable(c)&&b.applyBindingsToNode(e,{validationElement:c})}}}();a.makeBindingHandlerValidatable("value");a.makeBindingHandlerValidatable("checked");b.bindingHandlers.validationMessage={update:function(c,m){var e=m(),i=a.utils.getConfigOptions(c),o=d(e),n=null,g=false,h=false;if(!e.isValid||!e.isModified)throw new Error("Observable is not validatable");g=e.isModified();h=e.isValid();var j=null;if(!i.messagesOnModified||g)j=h?null:e.error;var l=!i.messagesOnModified||g?!h:false,k=c.style.display!=="none";if(i.allowHtmlMessages)f.setHtml(c,j);else b.bindingHandlers.text.update(c,function(){return j});if(k&&!l)c.style.display="none";else if(!k&&l)c.style.display=""}};b.bindingHandlers.validationElement={update:function(e,j){var c=j(),g=a.utils.getConfigOptions(e),l=d(c),k=null,h=false,f=false;if(!c.isValid||!c.isModified)throw new Error("Observable is not validatable");h=c.isModified();f=c.isValid();var i=function(){var a={},b=!g.decorateElementOnModified||h?!f:false;a[g.errorElementClass]=b;return a};b.bindingHandlers.css.update(e,i);if(!g.errorsAsTitle)return;b.bindingHandlers.attr.update(e,function(){var b=!g.errorsAsTitleOnModified||h,d=a.utils.getOriginalElementTitle(e);return b&&!f?{title:c.error,"data-orig-title":d}:!b||f?{title:d,"data-orig-title":null}:void 0})}};b.bindingHandlers.validationOptions=function(){return{init:function(g,f){var e=d(f());if(e){var b=c({},a.configuration);c(b,e);a.utils.setDomData(g,b)}}}}();b.extenders.validation=function(c,b){e(a.utils.isArray(b)?b:[b],function(b){a.addAnonymousRule(c,b)});return c};b.extenders.validatable=function(d,e){if(!a.utils.isObject(e))e={enable:e};if(!("enable"in e))e.enable=true;if(e.enable&&!a.utils.isValidatable(d)){var i=a.configuration.validate||{},g={throttleEvaluation:e.throttle||i.throttle};d.error=b.observable(null);d.rules=b.observableArray();d.isValidating=b.observable(false);d.__valid__=b.observable(true);d.isModified=b.observable(false);d.isValid=b.computed(d.__valid__);d.setError=function(a){d.error(a);d.__valid__(false)};d.clearError=function(){d.error(null);d.__valid__(true);return d};var h=d.subscribe(function(){d.isModified(true)}),f=b.computed(c({read:function(){var c=d(),b=d.rules();a.validateObservable(d);return true}},g));c(f,g);d._disposeValidation=function(){d.isValid.dispose();d.rules.removeAll();if(d.isModified.getSubscriptionsCount()>0)d.isModified._subscriptions.change=[];if(d.isValidating.getSubscriptionsCount()>0)d.isValidating._subscriptions.change=[];if(d.__valid__.getSubscriptionsCount()>0)d.__valid__._subscriptions.change=[];h.dispose();f.dispose();delete d.rules;delete d.error;delete d.isValid;delete d.isValidating;delete d.__valid__;delete d.isModified}}else e.enable===false&&d._disposeValidation&&d._disposeValidation();return d};function l(c,e,b){if(!e.validator(c(),b.params===undefined?true:d(b.params))){c.setError(a.formatMessage(b.message||e.message,d(b.params)));return false}else return true}function k(b,e,c){b.isValidating(true);var f=function(g){var f=false,h="";if(!b.__valid__()){b.isValidating(false);return}if(g.message){f=g.isValid;h=g.message}else f=g;if(!f){b.error(a.formatMessage(h||c.message||e.message,d(c.params)));b.__valid__(f)}b.isValidating(false)};e.validator(b(),d(c.params||true),f)}a.validateObservable=function(c){for(var e=0,d,b,f=c.rules(),g=f.length;e<g;e++){b=f[e];if(b.condition&&!b.condition())continue;d=b.rule?a.rules[b.rule]:b;if(d.async||b.async)k(c,d,b);else if(!l(c,d,b))return false}c.clearError();return true};a.localize=function(c){var d,b;for(b in c)if(a.rules.hasOwnProperty(b))a.rules[b].message=c[b]};b.applyBindingsWithValidation=function(g,e,h){var f=arguments.length,d,c;if(f>2){d=e;c=h}else if(f<2)d=document.body;else if(arguments[1].nodeType)d=e;else c=arguments[1];a.init();c&&a.utils.setDomData(d,c);b.applyBindings(g,e)};var j=b.applyBindings;b.applyBindings=function(b,c){a.init();j(b,c)};b.validatedObservable=function(d){if(!a.utils.isObject(d))return b.observable(d).extend({validatable:true});var c=b.observable(d);c.isValid=b.observable();c.errors=a.group(d);c.errors.subscribe(function(a){c.isValid(a.length===0)});return c}});