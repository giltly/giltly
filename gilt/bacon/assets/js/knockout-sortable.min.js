(function(a){if(typeof define==="function"&&define.amd)define(["knockout","jquery","jquery.ui.sortable"],a);else a(window.ko,jQuery)})(function(a,c){var g="ko_sortItem",l="ko_sourceIndex",h="ko_sortList",k="ko_parentList",m="ko_dragItem",b=a.utils.unwrapObservable,d=a.utils.domData.get,e=a.utils.domData.set,j=function(b,c){a.utils.arrayForEach(b,function(a){if(a.nodeType===1){e(a,g,c);e(a,k,d(a.parentNode,h))}})},f=function(g,e){var c={},d=b(g()),f;if(d.data){c[e]=d.data;c.name=d.template}else c[e]=g();a.utils.arrayForEach(["afterAdd","afterRender","as","beforeRemove","includeDestroyed","templateEngine","templateOptions"],function(b){c[b]=d[b]||a.bindingHandlers.sortable[b]});if(e==="foreach")if(c.afterRender){f=c.afterRender;c.afterRender=function(b,a){j.call(a,b,a);f.call(a,b,a)}}else c.afterRender=j;return c},i=function(d,e){var c=b(e);if(c)for(var a=0;a<d;a++)if(c[a]&&b(c[a]._destroy))d++;return d};a.bindingHandlers.sortable={init:function(n,t,u,x,w){var o=c(n),p=b(t())||{},q=f(t,"foreach"),j={},s,r;o.contents().each(function(){this&&this.nodeType!==1&&n.removeChild(this)});c.extend(true,j,a.bindingHandlers.sortable);if(p.options&&j.options){a.utils.extend(j.options,p.options);delete p.options}a.utils.extend(j,p);if(j.connectClass&&(a.isObservable(j.allowDrop)||typeof j.allowDrop=="function"))a.computed({read:function(){var c=b(j.allowDrop),d=typeof c=="function"?c.call(this,q.foreach):c;a.utils.toggleDomNodeCssClass(n,j.connectClass,d)},disposeWhenNodeIsRemoved:n},this);else a.utils.toggleDomNodeCssClass(n,j.connectClass,j.allowDrop);a.bindingHandlers.template.init(n,function(){return q},u,x,w);s=j.options.start;r=j.options.update;var v=setTimeout(function(){var f;o.sortable(a.utils.extend(j.options,{start:function(d,b){var c=b.item[0];e(c,l,a.utils.arrayIndexOf(b.item.parent().children(),c));b.item.find("input:focus").change();s&&s.apply(this,arguments)},receive:function(b,a){f=d(a.item[0],m);if(f){if(f.clone)f=f.clone();if(j.dragged)f=j.dragged.call(this,f,b,a)||f}},update:function(w,m){var o,t,s,p,n,b=m.item[0],v=m.item.parent()[0],u=d(b,g)||f;f=null;if(u&&(this===v||c.contains(this,v))){o=d(b,k);s=d(b,l);t=d(b.parentNode,h);p=a.utils.arrayIndexOf(m.item.parent().children(),b);if(!q.includeDestroyed){s=i(s,o);p=i(p,t)}if(j.beforeMove||j.afterMove)n={item:u,sourceParent:o,sourceParentNode:o&&m.sender||b.parentNode,sourceIndex:s,targetParent:t,targetIndex:p,cancelDrop:false};if(j.beforeMove){j.beforeMove.call(this,n,w,m);if(n.cancelDrop){if(n.sourceParent)c(n.sourceParent===n.targetParent?this:m.sender).sortable("cancel");else c(b).remove();return}}if(p>=0){if(o){o.splice(s,1);a.processAllDeferredBindingUpdates&&a.processAllDeferredBindingUpdates()}t.splice(p,0,u)}e(b,g,null);m.item.remove();a.processAllDeferredBindingUpdates&&a.processAllDeferredBindingUpdates();j.afterMove&&j.afterMove.call(this,n,w,m)}r&&r.apply(this,arguments)},connectWith:j.connectClass?"."+j.connectClass:false}));j.isEnabled!==undefined&&a.computed({read:function(){o.sortable(b(j.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:n})},0);a.utils.domNodeDisposal.addDisposeCallback(n,function(){o.data("sortable")&&o.sortable("destroy");clearTimeout(v)});return{controlsDescendantBindings:true}},update:function(c,g,d,j,i){var b=f(g,"foreach");e(c,h,b.foreach);a.bindingHandlers.template.update(c,function(){return b},d,j,i)},connectClass:"ko_container",allowDrop:true,afterMove:null,beforeMove:null,options:{}};a.bindingHandlers.draggable={init:function(g,i,l,q,o){var d=b(i())||{},p=d.options||{},h=a.utils.extend({},a.bindingHandlers.draggable.options),n=f(i,"data"),j=d.connectClass||a.bindingHandlers.draggable.connectClass,k=d.isEnabled!==undefined?d.isEnabled:a.bindingHandlers.draggable.isEnabled;d=d.data||d;e(g,m,d);a.utils.extend(h,p);h.connectToSortable=j?"."+j:false;c(g).draggable(h);k!==undefined&&a.computed({read:function(){c(g).draggable(b(k)?"enable":"disable")},disposeWhenNodeIsRemoved:g});return a.bindingHandlers.template.init(g,function(){return n},l,q,o)},update:function(g,d,b,h,e){var c=f(d,"data");return a.bindingHandlers.template.update(g,function(){return c},b,h,e)},connectClass:a.bindingHandlers.sortable.connectClass,options:{helper:"clone"}}});