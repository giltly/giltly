(function(a){a.widget("metro.calendar",{version:"1.0.0",options:{format:"yyyy-mm-dd",multiSelect:false,startMode:"day",months:["January"," February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan"," Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],buttonsNames:["Today","Clear"],date:new Date,buttons:true,getDates:function(){},click:function(){},_storage:[]},_year:0,_month:0,_day:0,_today:new Date,_mode:"day",_distance:0,_events:[],_create:function(){var a=this.element;if(a.data("multiSelect")!=undefined)this.options.multiSelect=a.data("multiSelect");if(a.data("format")!=undefined)this.options.format=a.data("format");if(a.data("date")!=undefined)this.options.date=new Date(a.data("date"));if(a.data("months")!=undefined)this.options.months=a.data("months");if(a.data("weekDays")!=undefined)this.options.weekDays=a.data("weekDays");if(a.data("startMode")!=undefined)this.options.startMode=a.data("startMode");this._year=this.options.date.getFullYear();this._distance=parseInt(this.options.date.getFullYear())-4;this._month=this.options.date.getMonth();this._day=this.options.date.getDate();this._mode=this.options.startMode;a.data("_storage",[]);this._renderCalendar()},_renderMonth:function(){var f=this._year,g=this._month,n=this._day,j=28;if(g==1)if(f%100!=0&&f%4==0||f%400==0)j=29;var l=["31",""+j+"","31","30","31","30","31","31","30","31","30","31"],k=l[g],i=(new Date(f,g,1)).getDay(),e,b,d,c;this.element.html("");e=a("<table/>").addClass("bordered");b=a("<tr/>");a("<td/>").addClass("text-center").html("<a class='btn-previous-year' href='#'><i class='icon-previous'></i></a>").appendTo(b);a("<td/>").addClass("text-center").html("<a class='btn-previous-month' href='#'><i class='icon-arrow-left-4'></i></a>").appendTo(b);a("<td/>").attr("colspan",3).addClass("text-center").html("<a class='btn-select-month' href='#'>"+this.options.months[g]+" "+f+"</a>").appendTo(b);a("<td/>").addClass("text-center").html("<a class='btn-next-month' href='#'><i class='icon-arrow-right-4'></i></a>").appendTo(b);a("<td/>").addClass("text-center").html("<a class='btn-next-year' href='#'><i class='icon-next'></i></a>").appendTo(b);b.addClass("calendar-header").appendTo(e);b=a("<tr/>");for(c=0;c<7;c++)d=a("<td/>").addClass("text-center day-of-week").html(this.options.weekDays[c]).appendTo(b);b.addClass("calendar-subheader").appendTo(e);b=a("<tr/>");for(c=0;c<i;c++)d=a("<td/>").addClass("empty").html("").appendTo(b);var h=i;for(c=1;c<=k;c++){h%=7;if(h==0){b.appendTo(e);b=a("<tr/>")}d=a("<td/>").addClass("text-center day").html("<a href='#'>"+c+"</a>");f==this._today.getFullYear()&&g==this._today.getMonth()&&this._today.getDate()==c&&d.addClass("today");var m=(new Date(this._year,this._month,c)).format("yyyy-mm-dd");this.element.data("_storage").indexOf(m)>=0&&d.find("a").addClass("selected");d.appendTo(b);h++}for(c=h+1;c<=7;c++)d=a("<td/>").addClass("empty").html("").appendTo(b);b.appendTo(e);if(this.options.buttons){b=a("<tr/>").addClass("calendar-actions");d=a("<td/>").attr("colspan",7).addClass("text-left").html("<button class='button calendar-btn-today small success'>"+this.options.buttonsNames[0]+"</button>&nbsp;<button class='button calendar-btn-clear small warning'>"+this.options.buttonsNames[1]+"</button>");d.appendTo(b);b.appendTo(e)}e.appendTo(this.element);this.options.getDates(this.element.data("_storage"))},_renderMonths:function(){var d,b,e,c,f;this.element.html("");d=a("<table/>").addClass("bordered");b=a("<tr/>");a("<td/>").addClass("text-center").html("<a class='btn-previous-year' href='#'><i class='icon-arrow-left-4'></i></a>").appendTo(b);a("<td/>").attr("colspan",2).addClass("text-center").html("<a class='btn-select-year' href='#'>"+this._year+"</a>").appendTo(b);a("<td/>").addClass("text-center").html("<a class='btn-next-year' href='#'><i class='icon-arrow-right-4'></i></a>").appendTo(b);b.addClass("calendar-header").appendTo(d);b=a("<tr/>");f=0;for(c=0;c<12;c++){e=a("<td/>").addClass("text-center month").html("<a href='#' data-month='"+c+"'>"+this.options.monthsShort[c]+"</a>");this._month==c&&(new Date).getFullYear()==this._year&&e.addClass("today");e.appendTo(b);if((f+1)%4==0){b.appendTo(d);b=a("<tr/>")}f+=1}d.appendTo(this.element)},_renderYears:function(){var d,b,e,c,f;this.element.html("");d=a("<table/>").addClass("bordered");b=a("<tr/>");a("<td/>").addClass("text-center").html("<a class='btn-previous-year' href='#'><i class='icon-arrow-left-4'></i></a>").appendTo(b);a("<td/>").attr("colspan",2).addClass("text-center").html(this._distance+"-"+(this._distance+11)).appendTo(b);a("<td/>").addClass("text-center").html("<a class='btn-next-year' href='#'><i class='icon-arrow-right-4'></i></a>").appendTo(b);b.addClass("calendar-header").appendTo(d);b=a("<tr/>");f=0;for(c=this._distance;c<this._distance+12;c++){e=a("<td/>").addClass("text-center year").html("<a href='#' data-year='"+c+"'>"+c+"</a>");(new Date).getFullYear()==c&&e.addClass("today");e.appendTo(b);if((f+1)%4==0){b.appendTo(d);b=a("<tr/>")}f+=1}d.appendTo(this.element)},_renderCalendar:function(){switch(this._mode){case"year":this._renderYears();break;case"month":this._renderMonths();break;default:this._renderMonth()}this._initButtons()},_initButtons:function(){var b=this,c=this.element.find("table");if(this._mode=="day"){c.find(".btn-select-month").on("click",function(a){a.preventDefault();a.stopPropagation();b._mode="month";b._renderCalendar()});c.find(".btn-previous-month").on("click",function(a){a.preventDefault();a.stopPropagation();b._month-=1;if(b._month<0){b._year-=1;b._month=11}b._renderCalendar()});c.find(".btn-next-month").on("click",function(a){a.preventDefault();a.stopPropagation();b._month+=1;if(b._month==12){b._year+=1;b._month=0}b._renderCalendar()});c.find(".btn-previous-year").on("click",function(a){a.preventDefault();a.stopPropagation();b._year-=1;b._renderCalendar()});c.find(".btn-next-year").on("click",function(a){a.preventDefault();a.stopPropagation();b._year+=1;b._renderCalendar()});c.find(".calendar-btn-today").on("click",function(a){a.preventDefault();a.stopPropagation();b.options.date=new Date;b._year=b.options.date.getFullYear();b._month=b.options.date.getMonth();b._day=b.options.date.getDate();b._renderCalendar()});c.find(".calendar-btn-clear").on("click",function(a){a.preventDefault();a.stopPropagation();b.options.date=new Date;b._year=b.options.date.getFullYear();b._month=b.options.date.getMonth();b._day=b.options.date.getDate();b.element.data("_storage",[]);b._renderCalendar()});c.find(".day a").on("click",function(e){e.preventDefault();e.stopPropagation();var d=(new Date(b._year,b._month,parseInt(a(this).html()))).format(b.options.format),f=new Date(b._year,b._month,parseInt(a(this).html()));if(b.options.multiSelect){a(this).toggleClass("selected");if(a(this).hasClass("selected"))b._addDate(d);else b._removeDate(d)}else{c.find(".day a").removeClass("selected");a(this).addClass("selected");b.element.data("_storage",[]);b._addDate(d)}b.options.getDates(b.element.data("_storage"));b.options.click(d,f)})}else if(this._mode=="month"){c.find(".month a").on("click",function(c){c.preventDefault();c.stopPropagation();b._month=parseInt(a(this).data("month"));b._mode="day";b._renderCalendar()});c.find(".btn-previous-year").on("click",function(a){a.preventDefault();a.stopPropagation();b._year-=1;b._renderCalendar()});c.find(".btn-next-year").on("click",function(a){a.preventDefault();a.stopPropagation();b._year+=1;b._renderCalendar()});c.find(".btn-select-year").on("click",function(a){a.preventDefault();a.stopPropagation();b._mode="year";b._renderCalendar()})}else{c.find(".year a").on("click",function(c){c.preventDefault();c.stopPropagation();b._year=parseInt(a(this).data("year"));b._mode="month";b._renderCalendar()});c.find(".btn-previous-year").on("click",function(a){a.preventDefault();a.stopPropagation();b._distance-=10;b._renderCalendar()});c.find(".btn-next-year").on("click",function(a){a.preventDefault();a.stopPropagation();b._distance+=10;b._renderCalendar()})}},_addDate:function(a){var b=this.element.data("_storage").indexOf(a);b<0&&this.element.data("_storage").push(a)},_removeDate:function(b){var a=this.element.data("_storage").indexOf(b);this.element.data("_storage").splice(a,1)},setDate:function(a){var b;a=new Date(a);b=(new Date(a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate())).format("yyyy-mm-dd");this._addDate(b);this._renderCalendar()},getDate:function(a){return(new Date(a!=undefined?this.element.data("_storage")[a]:this.element.data("_storage")[0])).format(this.options.format)},getDates:function(){return this.element.data("_storage")},unsetDate:function(a){var b;a=new Date(a);b=(new Date(a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate())).format("yyyy-mm-dd");this._removeDate(b);this._renderCalendar()},_destroy:function(){},_setOption:function(b,a){this._super("_setOption",b,a)}})})(jQuery);$(function(){$("[data-role=calendar]").calendar()});