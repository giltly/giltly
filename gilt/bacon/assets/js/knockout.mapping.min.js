(function(a){if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object")a(require("knockout"),exports);else if(typeof define==="function"&&define.amd)define(["knockout","exports"],a);else a(ko,ko.mapping={})})(function(a,b){var B=true,c="__ko_mapping__",h=a.dependentObservable,n=0,i,k,r=["create","update","key","arrayChanged"],v={},g={include:["_destroy"],ignore:[],copy:[],observe:[]},d=g;function A(){var d=arguments,g=d.length,e={},f=[],b,a,c;while(g--){c=d[g];b=c.length;while(b--){a=c[b];if(!e[a]){e[a]=1;f.push(a)}}}return f}function o(c,d){var e;for(var a in d)if(d.hasOwnProperty(a)&&d[a]){e=b.getType(c[a]);if(a&&c[a]&&e!=="array"&&e!=="string")o(c[a],d[a]);else{var f=b.getType(c[a])==="array"&&b.getType(d[a])==="array";if(f)c[a]=A(c[a],d[a]);else c[a]=d[a]}}}function m(b,c){var a={};o(a,b);o(a,c);return a}b.isMapped=function(d){var b=a.utils.unwrapObservable(d);return b&&b[c]};b.fromJS=function(f){if(arguments.length==0)throw new Error("When calling ko.fromJS, pass the object you want to convert.");try{if(!n++){i=[];k=new u}var a,b;if(arguments.length==2)if(arguments[1][c])b=arguments[1];else a=arguments[1];if(arguments.length==3){a=arguments[1];b=arguments[2]}if(b)a=m(a,b[c]);a=p(a);var d=j(b,f,a);if(b)d=b;if(!--n)while(i.length){var e=i.pop();if(e){e();e.__DO.throttleEvaluation=e.throttleEvaluation}}d[c]=m(d[c],a);return d}catch(g){n=0;throw g;}};b.fromJSON=function(c){var d=a.utils.parseJson(c);arguments[0]=d;return b.fromJS.apply(this,arguments)};b.updateFromJS=function(){throw new Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!");};b.updateFromJSON=function(){throw new Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!");};b.toJS=function(f,e){!d&&b.resetDefaultOptions();if(arguments.length==0)throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");if(b.getType(d.ignore)!=="array")throw new Error("ko.mapping.defaultOptions().ignore should be an array.");if(b.getType(d.include)!=="array")throw new Error("ko.mapping.defaultOptions().include should be an array.");if(b.getType(d.copy)!=="array")throw new Error("ko.mapping.defaultOptions().copy should be an array.");e=p(e,f[c]);return b.visitModel(f,function(b){return a.utils.unwrapObservable(b)},e)};b.toJSON=function(d,e){var c=b.toJS(d,e);return a.utils.stringifyJson(c)};b.defaultOptions=function(){if(arguments.length>0)d=arguments[0];else return d};b.resetDefaultOptions=function(){d={include:g.include.slice(0),ignore:g.ignore.slice(0),copy:g.copy.slice(0),observe:g.observe.slice(0)}};b.getType=function(a){if(a&&typeof a==="object"){if(a.constructor===Date)return"date";if(a.constructor===Array)return"array"}return typeof a};function p(g,b){for(var a=m({},g),f=r.length-1;f>=0;f--){var c=r[f];if(!a[c])continue;if(!(a[""]instanceof Object))a[""]={};a[""][c]=a[c];delete a[c]}if(b){a.ignore=e(b.ignore,a.ignore);a.include=e(b.include,a.include);a.copy=e(b.copy,a.copy);a.observe=e(b.observe,a.observe)}a.ignore=e(a.ignore,d.ignore);a.include=e(a.include,d.include);a.copy=e(a.copy,d.copy);a.observe=e(a.observe,d.observe);a.mappedProperties=a.mappedProperties||{};a.copiedProperties=a.copiedProperties||{};return a}function e(c,d){if(b.getType(c)!=="array")if(b.getType(c)==="undefined")c=[];else c=[c];if(b.getType(d)!=="array")if(b.getType(d)==="undefined")d=[];else d=[d];return a.utils.arrayGetDistinctValues(c.concat(d))}function x(b,c){var d=a.dependentObservable;a.dependentObservable=function(e,i,c){c=c||{};if(e&&typeof e=="object")c=e;var g=c.deferEvaluation,f=false,j=function(c){var g=a.dependentObservable;a.dependentObservable=h;var e=a.isWriteableObservable(c);a.dependentObservable=g;var d=h({read:function(){if(!f){a.utils.arrayRemoveItem(b,c);f=true}return c.apply(c,arguments)},write:e&&function(a){return c(a)},deferEvaluation:true});if(B)d._wrapper=true;d.__DO=c;return d};c.deferEvaluation=true;var d=new h(e,i,c);if(!g){d=j(d);b.push(d)}return d};a.dependentObservable.fn=h.fn;a.computed=a.dependentObservable;var e=c();a.dependentObservable=d;a.computed=a.dependentObservable;return e}function j(d,e,g,n,D,z,X){var Y=b.getType(a.utils.unwrapObservable(e))==="array";z=z||"";if(b.isMapped(d)){var W=a.utils.unwrapObservable(d)[c];g=m(W,g)}var y={data:e,parent:X||D},A=function(){return g[n]&&g[n].create instanceof Function},J=function(b){return x(i,function(){return a.utils.unwrapObservable(D)instanceof Array?g[n].create({data:b||y.data,parent:y.parent,skip:v}):g[n].create({data:b||y.data,parent:y.parent})})},u=function(){return g[n]&&g[n].update instanceof Function},w=function(b,d){var c={data:d||y.data,parent:y.parent,target:a.utils.unwrapObservable(b)};if(a.isWriteableObservable(b))c.observable=b;return g[n].update(c)},P=k.get(e);if(P)return P;n=n||"";if(!Y)if(!s(e))switch(b.getType(e)){case"function":if(u())if(a.isWriteableObservable(e)){e(w(e));d=e}else d=w(e);else d=e;break;default:if(a.isWriteableObservable(d))if(u()){var C=w(d);d(C);return C}else{var C=a.utils.unwrapObservable(e);d(C);return C}else{var U=A()||u();if(A())d=J();else d=a.observable(a.utils.unwrapObservable(e));u()&&d(w(d));if(U)return d}}else{d=a.utils.unwrapObservable(d);if(!d)if(A()){var E=J();if(u())E=w(E);return E}else{if(u())return w(E);d={}}if(u())d=w(d);k.save(e,d);if(u())return d;q(e,function(b){var f=z.length?z+"."+b:b;if(a.utils.arrayIndexOf(g.ignore,f)!=-1)return;if(a.utils.arrayIndexOf(g.copy,f)!=-1){d[b]=e[b];return}if(typeof e[b]!="object"&&typeof e[b]!="array"&&g.observe.length>0&&a.utils.arrayIndexOf(g.observe,f)==-1){d[b]=e[b];g.copiedProperties[f]=true;return}var h=k.get(e[b]),i=j(d[b],e[b],g,b,d,f,d),c=h||i;if(g.observe.length>0&&a.utils.arrayIndexOf(g.observe,f)==-1){d[b]=a.utils.unwrapObservable(c);g.copiedProperties[f]=true;return}if(a.isWriteableObservable(d[b])){c=a.utils.unwrapObservable(c);d[b]()!==c&&d[b](c)}else{c=d[b]===undefined?c:a.utils.unwrapObservable(c);d[b]=c}g.mappedProperties[f]=true})}else{var T=[],O=false,h=function(a){return a};if(g[n]&&g[n].key){h=g[n].key;O=true}if(!a.isObservable(d)){d=a.observableArray([]);d.mappedRemove=function(a){var b=typeof a=="function"?a:function(b){return b===h(a)};return d.remove(function(a){return b(h(a))})};d.mappedRemoveAll=function(b){var c=f(b,h);return d.remove(function(b){return a.utils.arrayIndexOf(c,h(b))!=-1})};d.mappedDestroy=function(a){var b=typeof a=="function"?a:function(b){return b===h(a)};return d.destroy(function(a){return b(h(a))})};d.mappedDestroyAll=function(b){var c=f(b,h);return d.destroy(function(b){return a.utils.arrayIndexOf(c,h(b))!=-1})};d.mappedIndexOf=function(b){var c=f(d(),h),e=h(b);return a.utils.arrayIndexOf(c,e)};d.mappedGet=function(a){return d()[d.mappedIndexOf(a)]};d.mappedCreate=function(c){if(d.mappedIndexOf(c)!==-1)throw new Error("There already is an object with the key that you specified.");var b=A()?J(c):c;if(u()){var e=w(b,c);if(a.isWriteableObservable(b))b(e);else b=e}d.push(b);return b}}var V=f(a.utils.unwrapObservable(d),h).sort(),Q=f(e,h);O&&Q.sort();var R=a.utils.compareArrays(V,Q),B={},r,H,I=a.utils.unwrapObservable(e),M={},K=true;for(r=0,H=I.length;r<H;r++){var o=h(I[r]);if(o===undefined||o instanceof Object){K=false;break}M[o]=I[r]}var L=[],S=0;for(r=0,H=R.length;r<H;r++){var o=R[r],p,N=z+"["+r+"]";switch(o.status){case"added":var G=K?M[o.value]:l(a.utils.unwrapObservable(e),o.value,h);p=j(undefined,G,g,n,d,N,D);if(!A())p=a.utils.unwrapObservable(p);var F=t(a.utils.unwrapObservable(e),G,B);if(p===v)S++;else L[F-S]=p;B[F]=true;break;case"retained":var G=K?M[o.value]:l(a.utils.unwrapObservable(e),o.value,h);p=l(d,o.value,h);j(p,G,g,n,d,N,D);var F=t(a.utils.unwrapObservable(e),G,B);L[F]=p;B[F]=true;break;case"deleted":p=l(d,o.value,h)}T.push({event:o.status,item:p})}d(L);g[n]&&g[n].arrayChanged&&a.utils.arrayForEach(T,function(a){g[n].arrayChanged(a.event,a.item)})}return d}function t(b,d,c){for(var a=0,e=b.length;a<e;a++){if(c[a]===true)continue;if(b[a]===d)return a}return null}function w(e,d){var c;if(d)c=d(e);if(b.getType(c)==="undefined")c=e;return a.utils.unwrapObservable(c)}function l(b,e,f){b=a.utils.unwrapObservable(b);for(var c=0,g=b.length;c<g;c++){var d=b[c];if(w(d,f)===e)return d}throw new Error("When calling ko.update*, the key '"+e+"' was not found!");}function f(c,b){return a.utils.arrayMap(a.utils.unwrapObservable(c),function(a){return b?w(a,b):a})}function q(a,d){if(b.getType(a)==="array")for(var c=0;c<a.length;c++)d(c);else for(var e in a)d(e)}function s(a){var c=b.getType(a);return(c==="object"||c==="array")&&a!==null}function z(c,e,d){var a=c||"";if(b.getType(e)==="array"){if(c)a+="["+d+"]"}else{if(c)a+=".";a+=d}return a}b.visitModel=function(g,h,d){d=d||{};d.visitedObjects=d.visitedObjects||new u;var f,e=a.utils.unwrapObservable(g);if(!s(e))return h(g,d.parentName);else{d=p(d,e[c]);h(g,d.parentName);f=b.getType(e)==="array"?[]:{}}d.visitedObjects.save(g,f);var i=d.parentName;q(e,function(g){if(d.ignore&&a.utils.arrayIndexOf(d.ignore,g)!=-1)return;var j=e[g];d.parentName=z(i,e,g);if(a.utils.arrayIndexOf(d.copy,g)===-1)if(a.utils.arrayIndexOf(d.include,g)===-1)if(e[c]&&e[c].mappedProperties&&!e[c].mappedProperties[g]&&e[c].copiedProperties&&!e[c].copiedProperties[g]&&!(b.getType(e)==="array"))return;var l;switch(b.getType(a.utils.unwrapObservable(j))){case"object":case"array":case"undefined":var k=d.visitedObjects.get(j);f[g]=b.getType(k)!=="undefined"?k:b.visitModel(j,h,d);break;default:f[g]=h(j,d.parentName)}});return f};function y(){var c=[],b=[];this.save=function(f,e){var d=a.utils.arrayIndexOf(c,f);if(d>=0)b[d]=e;else{c.push(f);b.push(e)}};this.get=function(f){var d=a.utils.arrayIndexOf(c,f),e=d>=0?b[d]:undefined;return e}}function u(){var b={},a=function(d){var a;try{a=d}catch(e){a="$$$"}var c=b[a];if(c===undefined){c=new y;b[a]=c}return c};this.save=function(b,c){a(b).save(b,c)};this.get=function(b){return a(b).get(b)}}});