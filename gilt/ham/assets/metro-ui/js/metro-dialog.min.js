(function(a){var b=false;a.Dialog=function(c){if(!a.Dialog.opened)a.Dialog.opened=true;else return b;a.Dialog.settings=c;c=a.extend({icon:false,title:"",content:"",flat:false,shadow:false,overlay:false,width:"auto",height:"auto",position:"default",padding:false,overlayClickClose:true,sysButtons:{btnClose:true},onShow:function(){}},c);var f,d,e,g;f=a("<div/>").addClass("metro window-overlay");c.overlay&&f.css({backgroundColor:"rgba(0,0,0,.7)"});d=a("<div/>").addClass("window");c.flat&&d.addClass("flat");c.shadow&&d.addClass("shadow").css("overflow","hidden");e=a("<div/>").addClass("caption");g=a("<div/>").addClass("content");g.css({paddingTop:32+c.padding,paddingLeft:c.padding,paddingRight:c.padding,paddingBottom:c.padding});if(c.sysButtons){c.sysButtons.btnClose&&a("<button/>").addClass("btn-close").on("click",function(b){b.preventDefault();b.stopPropagation();a.Dialog.close()}).appendTo(e);c.sysButtons.btnMax&&a("<button/>").addClass("btn-max").on("click",function(a){a.preventDefault();a.stopPropagation()}).appendTo(e);c.sysButtons.btnMin&&a("<button/>").addClass("btn-min").on("click",function(a){a.preventDefault();a.stopPropagation()}).appendTo(e)}c.icon&&a(c.icon).addClass("icon").appendTo(e);a("<div/>").addClass("title").html(c.title).appendTo(e);g.html(c.content);e.appendTo(d);g.appendTo(d);d.appendTo(f);c.width!="auto"&&d.css("min-width",c.width);c.height!="auto"&&d.css("min-height",c.width);f.hide().appendTo("body").fadeIn("fast");b=d;d.css("position","fixed").css("top",c.position.offsetY?c.position.offsetY:Math.max(0,(a(window).height()-d.outerHeight())/2+a(window).scrollTop())+"px").css("left",c.position.offsetX?c.position.offsetX:Math.max(0,(a(window).width()-d.outerWidth())/2+a(window).scrollLeft())+"px");addTouchEvents(d[0]);if(c.draggable)e.on("mousedown",function(b){a.Dialog.drag=true;e.css("cursor","move");var i=d.css("z-index"),c=d.outerHeight(),f=d.outerWidth(),h=d.offset().top+c-b.pageY,g=d.offset().left+f-b.pageX;d.css("z-index",99999).parents().on("mousemove",function(b){var k=b.pageY>0?b.pageY+h-c:0,j=b.pageX>0?b.pageX+g-f:0;if(a.Dialog.drag){k>=0&&k<=window.innerHeight-d.outerHeight()&&d.offset({top:k});j>=0&&j<=window.innerWidth-d.outerWidth()&&d.offset({left:j})}d.on("mouseup",function(){a(this).removeClass("draggable").css("z-index",i);a.Dialog.drag=false;e.css("cursor","default")})});b.preventDefault()}).on("mouseup",function(){d.removeClass("draggable");a.Dialog.drag=false;e.css("cursor","default")});d.on("click",function(a){a.preventDefault();a.stopPropagation()});if(c.overlayClickClose)f.on("click",function(b){b.preventDefault();a.Dialog.close()});c.onShow(b);a.Dialog.autoResize();return b};a.Dialog.content=function(c){if(!a.Dialog.opened)return false;if(c){b.children(".content").html(c);a.Dialog.autoResize()}else return b.children(".content").html()};a.Dialog.title=function(c){if(!a.Dialog.opened)return false;if(c)b.children(".caption > .title").html(c);else b.children(".caption > .title").html()};a.Dialog.autoResize=function(){if(!a.Dialog.opened)return false;var c=b.children(".content");console.log(c.width(),c.height());b.css({width:c.width(),height:c.height()+36}).css("top",Math.max(0,(a(window).height()-b.outerHeight())/2+a(window).scrollTop())+"px").css("left",Math.max(0,(a(window).width()-b.outerWidth())/2+a(window).scrollLeft())+"px")};a.Dialog.close=function(){if(!a.Dialog.opened||b==undefined)return false;a.Dialog.opened=false;var c=b.parent(".window-overlay");c.fadeOut(function(){a(this).remove()})}})(jQuery);